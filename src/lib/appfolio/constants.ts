/**
 * PROPERTY GROUPS - Late Fee Threshold Configuration
 *
 * Properties are divided into two groups with different late fee rules:
 *
 * GROUP A (Cook County): $1000 threshold
 *   - If total owed > $1000: fee = (total - $1000) * 5% + $10
 *   - If total owed <= $1000: fee = $10
 *
 * GROUP B (Chicago): $500 threshold
 *   - If total owed > $500: fee = (total - $500) * 5% + $10
 *   - If total owed <= $500: fee = $10
 *
 * IMPORTANT: If 0-30 day balance = $0, fee is always $0 (no recent charges)
 *
 * Configuration:
 *   - Set PROPERTY_GROUP_A_IDS in .env for Cook County properties
 *   - Set PROPERTY_GROUP_B_IDS in .env for Chicago properties
 *   - Properties not in either group use default ($500 threshold)
 */

// Parse comma-separated property IDs from environment variable
function parsePropertyIds(envValue: string | undefined): Set<string> {
  if (!envValue) return new Set();
  return new Set(
    envValue.split(',').map(id => id.trim()).filter(Boolean)
  );
}

// Get groups from environment variables (set at build time or runtime)
const ENV_GROUP_A = typeof process !== 'undefined' ? process.env.PROPERTY_GROUP_A_IDS : undefined;
const ENV_GROUP_B = typeof process !== 'undefined' ? process.env.PROPERTY_GROUP_B_IDS : undefined;

// Default production property IDs (used if env vars not set)
const DEFAULT_GROUP_A = [
  "8006","8007","8008","8009","8010",
  "9099","9144","9148","9164","9169","9173","9212","9232","9250","9308",
  "9314","9327","9331","9337","9341","9345","9351","9356","9359","9370",
  "9374","9378","9384","9388","9392","9396","9429","9432","9467","9502",
  "9503","9504","9505","9506","9507","9508","9509","9510","9511","9512",
  "9513","9514","9515","9516","9517","9525","9530","9531","9538","9544"
];

const DEFAULT_GROUP_B = [
  "8011","8012","8013","8014","8015","9084","9085","9086","9087","9088",
  "9089","9090","9091","9092","9093","9094","9095","9096","9097","9098",
  "9100","9101","9102","9103","9104","9105","9106","9107","9108","9109",
  "9110","9111","9112","9113","9114","9115","9116","9117","9118","9119",
  "9120","9121","9122","9123","9124","9125","9126","9127","9128","9129",
  "9130","9131","9132","9133","9134","9135","9136","9137","9138","9139",
  "9140","9141","9142","9143","9145","9146","9147","9149","9150","9151",
  "9152","9153","9154","9155","9156","9157","9158","9159","9160","9161",
  "9162","9163","9165","9166","9167","9168","9170","9171","9172","9174",
  "9175","9176","9177","9178","9179","9180","9181","9182","9183","9184",
  "9185","9186","9187","9188","9189","9190","9191","9192","9193","9194",
  "9195","9196","9197","9198","9199","9200","9201","9202","9203","9204",
  "9205","9206","9207","9208","9209","9210","9211","9213","9214","9215",
  "9216","9217","9218","9219","9220","9221","9222","9223","9224","9225",
  "9226","9227","9228","9229","9230","9231","9233","9234","9235","9236",
  "9237","9238","9239","9240","9241","9242","9243","9244","9245","9246",
  "9247","9248","9249","9251","9252","9253","9254","9255","9256","9257",
  "9258","9259","9260","9261","9262","9263","9264","9265","9266","9267",
  "9268","9269","9270","9271","9272","9273","9274","9275","9276","9277",
  "9278","9279","9280","9281","9282","9283","9284","9285","9286","9287",
  "9288","9289","9290","9291","9292","9293","9294","9295","9296","9297",
  "9298","9299","9300","9301","9302","9303","9304","9305","9306","9307",
  "9309","9310","9311","9312","9313","9315","9316","9317","9318","9319",
  "9320","9321","9322","9323","9324","9325","9326","9328","9329","9330",
  "9332","9333","9334","9335","9336","9338","9339","9340","9342","9343",
  "9344","9346","9347","9348","9349","9350","9352","9353","9354","9355",
  "9357","9358","9360","9361","9362","9363","9364","9365","9366","9367",
  "9368","9369","9371","9372","9373","9375","9376","9377","9379","9380",
  "9381","9382","9383","9385","9386","9387","9389","9390","9391","9393",
  "9394","9395","9397","9398","9399","9400","9401","9402","9403","9404",
  "9405","9406","9407","9408","9409","9410","9411","9412","9413","9414",
  "9415","9416","9417","9418","9419","9420","9421","9422","9423","9424",
  "9425","9426","9427","9428","9430","9431","9433","9434","9435","9436",
  "9437","9438","9439","9440","9441","9442","9443","9444","9445","9446",
  "9447","9448","9449","9450","9451","9452","9453","9454","9455","9456",
  "9457","9458","9459","9460","9461","9462","9463","9464","9465","9466",
  "9468","9469","9470","9471","9472","9473","9474","9475","9476","9477",
  "9478","9479","9480","9481","9482","9483","9484","9485","9486","9487",
  "9488","9489","9490","9491","9492","9493","9494","9495","9496","9497",
  "9498","9499","9500","9501","9518","9519","9520","9521","9522","9523",
  "9524","9526","9527","9528","9529","9532","9533","9534","9535","9536",
  "9537","9539","9540","9541","9542","9543","9545","9546","9547","9548",
  "9549","9550","9551","9552","9553","9554","9555","9556","9557","9558",
  "9559","9560","9561","9562","9563","9564"
];

// Use env vars if set, otherwise use defaults
export const PROPERTY_GROUP_A: Set<string> = ENV_GROUP_A
  ? parsePropertyIds(ENV_GROUP_A)
  : new Set(DEFAULT_GROUP_A);

export const PROPERTY_GROUP_B: Set<string> = ENV_GROUP_B
  ? parsePropertyIds(ENV_GROUP_B)
  : new Set(DEFAULT_GROUP_B);

export const MONTH_ABBR = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

// Default late fee parameters (fallback for unknown properties)
export const DEFAULT_LATE_FEE_THRESHOLD = 500;
export const DEFAULT_LATE_FEE_PERCENT = 0.05;
export const DEFAULT_LATE_FEE_BASE = 10;

// CSV export headers
export const CSV_HEADERS = [
  "Property Name",
  "Unit Name",
  "Occupancy UID",
  "Tenant Name",
  "Occupancy ID",
  "Amount",
  "Charge Date",
  "Posting Date",
  "Gl Account Number",
  "Description",
];
